# Дебъгване в Chrome

Преди да започнем да пишем по-сложен код, нека поговорим за дебъгването.

[Debugging](https://en.wikipedia.org/wiki/Debugging) е процес при който се откриват и оправят грешки в кода. Всички съвременни браузъри и повечето други среди поддържат инструменти за дебъгване -- специален UI в developer tools (инструментите за разработчици), който прави дебъгването много по-лесно. Те позволяват да се проследи изпълнението на кода стъпка по стъпка, за да видим какво точно се случва.

Ние ще използваме Chrome, защото има достатъчно функции, повечето от другите браузъри имат подобен процес.

## Панелът "Sources"

Вашата версия на Chrome може да изглежда различно, но основните неща са си същите.

- Отворете [example page](debugging/index.html) в Chrome.
- Активирайте developer tools (инструментите за разработчици) с `key:F12` (Mac: `key:Cmd+Opt+I`).
- Изберете `Sources` панелът.

Ето какво ще видите, ако правите това за първи път:

![](chrome-open-sources.svg)

Бутонът <span class="devtools" style="background-position:-172px -98px"></span> отваря табът с файлове.

Нека кликнем на него и изберем `hello.js` в дървовидния изглед. Ето какво ще се покаже:

![](chrome-tabs.svg)

Панелът Sources има 3 части:

1. Панелът **File Navigator (файлов навигатор)** показва HTML, JavaScript, CSS и други файлове, включително изображения, които са прикрепени към страницата. Тук може да се показват и разширения на Chrome.
2. Панелът **Code Editor** показва сорс кода.
3. Панелът **JavaScript Debugging** е за дебъгване. Ще го разгледаме скоро.

Сега кликнете отново на същия бутон <span class="devtools" style="background-position:-172px -122px"></span> за да скриете списъка с ресурсите и да освободите повече място за кода.

## Конзола

Ако натиснем `key:Esc`, долу ще се отвори конзолата. В нея може да пишем команди и като натиснем `key:Enter` да ги изпълним.

След като се изпълни инструкцията, резултатът се показва долу.

Например `1+2` връща `3`, а `hello("debugger")` не връща нищо и затова резултатът е `undefined`:

![](chrome-sources-console.svg)

## Breakpoints (Брейкпоинти)

Нека видим какво се случва вътре в кода на [example page](debugging/index.html). В `hello.js`, кликнете на ред `4`. Да, точно на числото `4`  а не на кода.

Поздравления! Поставихте брейкпойнт. Моля, кликнете също и на числото `8`.

Би трябвало да изглежда така (синьото е където трябва да кликнете):

![](chrome-sources-breakpoint.svg)

*Брейкпойнтът* е място в кода, където дебъгерът автоматично ще паузира изпълнението на JavaScript.

Докато кодът е паузиран, може да проследим текущите променливи, да изпълняваме команди в конзолата и т.н. С други думи можем да го дебъгваме.

В дeсния панел има списък с брейкпойнти. Това е полезно когато имаме много брейкпойнти в различни файлове. Този списък ни позволява:
- Бързо да прескочим до брейкпойнт в кода (като кликнем на него в десния панел).
- Временно да деактивираме брейкпойнт като го размаркираме.
- Да премахнем брейкпойнт като кликнем на него с десен бутон на мишката и изберем Remove.
- ...И така нататък.

```smart header="Conditional breakpoints (Условни брейкпойнти)"
*Кликване с десен бутон на мишката* върх номера на реда, ни позволява да създадем *conditional (условен)* брейкпойнт. Той се активира само когато зададеното условие е вярно.

Това е полезно когато искаме изпълнението на кода да спре при конкретна стойност или параметри на функция.
```

## Командата Debugger

Може да спрем изпълнението на кода и като използваме командата `debugger` в него ето така:

```js
function hello(name) {
  let phrase = `Здравей, ${name}!`;

*!*
  debugger;  // <-- дебъгерът спира изпълнението на кода тук
*/!*

  say(phrase);
}
```

Това е много удобно, когато сме в code editor (редактор на код) и не искаме да превключваме към браузъра и да гледаме скрипта в инструментите за разработчици, за да поставим брейкпойнт. 


## Паузирай кода и виж какво се случва

В нашия пример, `hello()` се извиква по време на зареждането на страницата, така че най-лесният начин да активираме дебъгера (след като сме сложили брейкпойнти) е да презаредим страницата. За целта натиснете `key:F5` (Windows, Linux) or `key:Cmd+R` (Mac).

Тъй като има поставен брейкпойнт, изпълнението на програмата спира на ред 4:

![](chrome-sources-debugger-pause.svg)

Моля отворете информационните падащи менюта отдясно (маркирани със стрелки). Те ни позволяват да видим текущото състояние на кода:

1. **`Watch` -- показва текущата стойност за даден израз.**

    Може да натиснете знакът плюс `+` и да въведете израз. Дебъгерът ще покаже неговата стойност във всеки един момент, като я преизчислява автоматично в процеса на изпълнение на кода. 

2. **`Call Stack` -- показва веригата на вложените извиквания.**

    В текущия момент дебъгерът е вътре в `hello()` заявката, извикана от скрипта `index.html` (тук няма функция, затова я наричаме "анонимна").

    Ако кликнете на stack item /предмет от купчината/ (пр. "anonymous"), дебъгерът ще прескочи до съответния код и всички негови променливи може да бъдат разгледани.
3. **`Scope` -- текущите променливи.**

    `Local` показва локалните функционални променливи. Може да видите техните стойности, изписани точно над кода.

    `Global` показва глобалните променливи (извън всички функции).

    Тук е и ключовата дума `this`, която не сме разглеждали още, но ще го направим скоро.

## Проследяване на изпълнението

Време е да *проследим* скрипта.

Има бутони за това в горната част на десния панел. Нека ги активираме.
<!-- https://github.com/ChromeDevTools/devtools-frontend/blob/master/front_end/Images/src/largeIcons.svg -->
<span class="devtools" style="background-position:-146px -168px"></span> -- "Resume": продължи изпълнението, бутон `key:F8`.
: продължава изпълнението. Ако няма допълнителни брейкпойнти, изпълнението на кода продължава до края и дебъгерът губи контрол. 

    Ето какво ще видим след като кликнем на него:

    ![](chrome-sources-debugger-trace-1.svg)

    Изпълнението на кода продължава, стига до другия брейкпойнт `say()` и спира там. Нека погледнем "Call Stack" в дясно. Той се е увеличил с още едно извикване. Сега сме в `say()`.

<span class="devtools" style="background-position:-200px -190px"></span> -- "Step": изпълни следващата команда, бутон `key:F9`.
: Изпълни следващата инструкция. Ако го кликнем сега, ще се покаже `alert`.

    Натискайки този бутон отново и отново ще преминем последователно през всички инструкции в скрипта една по една.

<<<<<<< HEAD
<span class="devtools" style="background-position:-62px -192px"></span> -- "Step over": изпълни следващата команда, но *не влизай вътре във функция*, бутон `key:F10`.
: Подобна е на предишната "Step" команда, но се държи различно ако следващата инструкция е функция. Това важи не за вградена функция като `alert`, а за такава, която ние сме написали.
=======
<span class="devtools" style="background-position:-62px -192px"></span> -- "Step over": run the next command, but *don't go into a function*, hotkey `key:F10`.
: Similar to the previous "Step" command, but behaves differently if the next statement is a function call. That is: not a built-in, like `alert`, but a function of our own.
>>>>>>> 97ef86242f9f236b13152e1baf52a55c4db8728a

    Командата "Step" влиза вътре и спира изпълнението оше на първия ред, докато "Step over" изпълнява вложената функция без да влиза вътре в нея.

    Изпълнението на кода спира веднага след функцията.

    Това е добре ако не ни интересува какво се случва вътре във функцията по време на нейното изпълнение.

<span class="devtools" style="background-position:-4px -194px"></span> -- "Step into", бутон `key:F11`.
: Той е подобен на "Step", но се държи различно в случай на асинхронно извикване на функции. Ако сега започвате да изучавате JavaScript, тогава може да пренебрегнете разликата, тъй като все още нямаме асинхронни извиквания.

    За в бъдеще запомнете, че командата "Step" игнорира асинхронни действия като `setTimeout` (планирано във времето извикване на функция), която се изпълнява по-късно. "Step into" влиза в техния код и ги изчаква, ако е необходимо. Вижте [DevTools manual](https://developers.google.com/web/updates/2018/01/devtools#async) за повече информация.

<span class="devtools" style="background-position:-32px -194px"></span> -- "Step out": продължи изпълнението докато стигнеш края на текущата функция, клавишна комбинация `key:Shift+F11`.
: Продължете изпълнението и спрете на последния ред от текущата функция. Това е полезно когато инцидентно сме влезли във вложени извиквания използвайки бутона step<span class="devtools" style="background-position:-200px -190px"></span>, но това не ни интересува и искаме да стигнем края на този код по-бързо.

<span class="devtools" style="background-position:-61px -74px"></span> -- включи/изключи всички брейкпойнти.
: Този бутон не влияе пряко върху изпълнението на кода. Той включва и изключва всички брейкпойнти.

<span class="devtools" style="background-position:-90px -146px"></span> -- включи/изключи автоматичната пауза в случай на грешка.
: Когато е активиран и инструментите на разработчика са отворени, при грешка в кода изпълнението на програмата спира автоматично. Така можем да анализираме променливите и да видим какво се е объркало. Така ако нашият код се счупи, ние можем да отворим дебъгера, да включим тази опция, да презаредим страницата и да видим къде се появява грешката и какъв е контекстът в този момент. 

```smart header="Continue to here (продължи до тук)"
Кликване с десния бутон на мишката върху ред от код отваря контекстно меню с чудесна опция наречена "Продължи до тук".

Това е полезно когато искаме да придвижим множество стъпки напред до определен ред, но не искаме да поставяме брейкпойнт.
```

## Logging (Принтиране)

За да принтираме нещо от нашия код на конзолата, използваме функцията `console.log`.

Например този код принтира числата от `0` до `4` на конзолата:

```js run
// отворете конзолата за да видите принтираните стойности
for (let i = 0; i < 5; i++) {
  console.log("value,", i);
}
```

Обикновените потребители не виждат този текст, той е в конзолата. За да го видите отворете конзолата от инструментите за разработчици или натиснете `key:Esc` докато сте в друг панел: това отваря конзолата в долния край.

Ако имаме достатъчно логове в нашия код, можем да видим какво се случва от записите без да ползваме дебъгер.

## Обобщение
Както видяхме има три основни начина да паузираме скрипт:
1. Брейкпойнт.
2. Инструкцията `debugger`.
3. Грешка (ако dev tools са отворени и бутонът <span class="devtools" style="background-position:-90px -146px"></span> е "включен").

Когато изпълнението на кода спре, можем да дебъгваме - да прегледаме променливите и да проследим кода, за да видим къде има грешка в изпълнението му.

Има още много опции на инструментите за разработчици, които не сме разгледали тук. Цялата инструкция е на <https://developers.google.com/web/tools/chrome-devtools>.

Информацията от тази глава е достатъчна да започнете с дебъгването, но по-късно, особено ако ползвате много често браузъра, прегледайте документацията за по-напредналите възможности на инструментите за разработчици.

Също така може да кликате на различни места в инструментите за разработчици и да видите какво се показва. Това вероятно е най-бързият начин да ги научите. Не забравяйте за кликването с десния бутон на мишката и контекстните менюта!
